<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MJ Radio Player - Patrick Workout</title>
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #1a1a2e; color: white; font-family: -apple-system, sans-serif; min-height: 100vh; padding: 20px; }
    h1 { text-align: center; margin-bottom: 10px; font-size: 1.3em; }
    h2 { text-align: center; margin-bottom: 20px; font-size: 1em; opacity: 0.6; }
    
    .workout-sim {
        background: rgba(255,255,255,0.08);
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 15px;
        text-align: center;
    }
    .exercise-name { font-size: 1.4em; font-weight: 700; margin-bottom: 8px; }
    .exercise-info { opacity: 0.6; margin-bottom: 15px; }
    .timer { font-size: 3em; font-weight: 700; color: #06d6a0; font-variant-numeric: tabular-nums; }
    
    .player-section {
        background: rgba(255,255,255,0.05);
        border-radius: 16px;
        padding: 15px;
    }
    .player-label { font-size: 0.85em; opacity: 0.5; margin-bottom: 10px; text-align: center; }
    
    .genre-tabs { display: flex; gap: 8px; margin-bottom: 12px; justify-content: center; flex-wrap: wrap; }
    .genre-tab {
        padding: 8px 14px;
        border-radius: 20px;
        border: 1px solid rgba(255,255,255,0.2);
        background: rgba(255,255,255,0.05);
        color: white;
        cursor: pointer;
        font-size: 0.8em;
        transition: all 0.2s;
    }
    .genre-tab.active { background: #06d6a0; border-color: #06d6a0; color: #000; font-weight: 600; }
    
    .station-list {
        max-height: 200px;
        overflow-y: auto;
        margin-bottom: 12px;
        scrollbar-width: thin;
    }
    .station-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s;
    }
    .station-item:hover { background: rgba(255,255,255,0.08); }
    .station-item.playing { background: rgba(6,214,160,0.15); border-left: 3px solid #06d6a0; }
    .station-logo {
        width: 40px; height: 40px;
        border-radius: 8px;
        background: rgba(255,255,255,0.1);
        display: flex; align-items: center; justify-content: center;
        font-size: 1.2em;
        overflow: hidden;
    }
    .station-logo img { width: 100%; height: 100%; object-fit: cover; }
    .station-name { font-size: 0.9em; font-weight: 600; }
    .station-tags { font-size: 0.7em; opacity: 0.5; }
    
    .now-playing {
        display: none;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: rgba(6,214,160,0.1);
        border-radius: 12px;
        margin-bottom: 12px;
    }
    .now-playing.active { display: flex; }
    .np-info { flex: 1; }
    .np-name { font-size: 0.9em; font-weight: 700; }
    .np-genre { font-size: 0.75em; opacity: 0.5; }
    .np-controls { display: flex; gap: 8px; }
    .np-btn {
        width: 40px; height: 40px;
        border-radius: 50%;
        border: none;
        background: #06d6a0;
        color: #000;
        font-size: 1.1em;
        cursor: pointer;
        display: flex; align-items: center; justify-content: center;
    }
    .np-btn.stop { background: rgba(255,255,255,0.15); color: white; }
    
    .eq-bars {
        display: flex;
        gap: 2px;
        height: 20px;
        align-items: flex-end;
    }
    .eq-bar {
        width: 3px;
        background: #06d6a0;
        border-radius: 2px;
        animation: equalize 0.8s ease infinite alternate;
    }
    .eq-bar:nth-child(1) { animation-duration: 0.6s; height: 8px; }
    .eq-bar:nth-child(2) { animation-duration: 0.9s; height: 14px; }
    .eq-bar:nth-child(3) { animation-duration: 0.7s; height: 10px; }
    .eq-bar:nth-child(4) { animation-duration: 1.1s; height: 16px; }
    
    @keyframes equalize {
        from { height: 4px; }
        to { height: 20px; }
    }
    
    .volume-row { display: flex; align-items: center; gap: 10px; padding: 8px 0; }
    .volume-row span { font-size: 0.8em; opacity: 0.5; }
    .volume-slider {
        flex: 1;
        -webkit-appearance: none;
        height: 4px;
        border-radius: 2px;
        background: rgba(255,255,255,0.2);
        outline: none;
    }
    .volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 16px; height: 16px;
        border-radius: 50%;
        background: #06d6a0;
        cursor: pointer;
    }
    
    .note { text-align: center; opacity: 0.4; font-size: 0.75em; margin-top: 15px; }
</style>
</head>
<body>

<h1>üí™ Patrick Workout</h1>
<h2>üìª MJ Radio Player Test</h2>

<div class="workout-sim">
    <div class="exercise-name">üçë Clamshells</div>
    <div class="exercise-info">15 each side</div>
    <div class="timer" id="timer">0:45</div>
</div>

<div class="player-section">
    <div class="player-label">üìª MJ Radio Workout</div>
    
    <div class="genre-tabs" id="genreTabs">
        <button class="genre-tab active" onclick="loadGenre('energy')">üî• Energy</button>
        <button class="genre-tab" onclick="loadGenre('chill')">üßò Chill</button>
        <button class="genre-tab" onclick="loadGenre('hiphop')">üé§ Hip-Hop</button>
        <button class="genre-tab" onclick="loadGenre('dance')">üíÉ Dance</button>
    </div>
    
    <div class="now-playing" id="nowPlaying">
        <div class="eq-bars">
            <div class="eq-bar"></div>
            <div class="eq-bar"></div>
            <div class="eq-bar"></div>
            <div class="eq-bar"></div>
        </div>
        <div class="np-info">
            <div class="np-name" id="npName">‚Äî</div>
            <div class="np-genre" id="npGenre">‚Äî</div>
        </div>
        <div class="np-controls">
            <button class="np-btn stop" onclick="stopRadio()">‚èπ</button>
        </div>
    </div>
    
    <div class="volume-row">
        <span>üîà</span>
        <input type="range" class="volume-slider" id="volume" min="0" max="100" value="80" oninput="setVolume(this.value)">
        <span>üîä</span>
    </div>
    
    <div class="station-list" id="stationList">
        <div style="text-align:center;opacity:0.5;padding:20px;">Caricamento stazioni...</div>
    </div>
</div>

<div class="note">Brani completi ‚Ä¢ Gratis ‚Ä¢ Nessun limite üé∂</div>

<audio id="audio" preload="none"></audio>

<script>
const API = 'https://de1.api.radio-browser.info/json';
const audio = document.getElementById('audio');
let currentStation = null;

const GENRES = {
    energy: { tags: 'workout,fitness,energy', fallback: 'dance,electronic,edm', name: 'Energy' },
    chill: { tags: 'chill,chillout,ambient,lounge', fallback: 'yoga,meditation,relaxation', name: 'Chill' },
    hiphop: { tags: 'hip hop,hiphop,rap', fallback: 'urban,r&b,rnb', name: 'Hip-Hop' },
    dance: { tags: 'dance,house,edm,electronic', fallback: 'club,techno,trance', name: 'Dance' }
};

async function loadGenre(genre) {
    document.querySelectorAll('.genre-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    
    const list = document.getElementById('stationList');
    list.innerHTML = '<div style="text-align:center;opacity:0.5;padding:20px;">Caricamento...</div>';
    
    const g = GENRES[genre];
    let stations = [];
    
    // Try primary tags first, then fallback
    for (const tagSet of [g.tags, g.fallback]) {
        for (const tag of tagSet.split(',')) {
            try {
                const resp = await fetch(`${API}/stations/search?tag=${tag.trim()}&limit=15&order=clickcount&reverse=true&lastcheckok=1`);
                const data = await resp.json();
                const https = data.filter(s => s.url_resolved?.startsWith('https'));
                stations = [...stations, ...https];
            } catch(e) {}
        }
        if (stations.length >= 5) break;
    }
    
    // Deduplicate by name
    const seen = new Set();
    stations = stations.filter(s => {
        const key = s.name.toLowerCase().trim();
        if (seen.has(key)) return false;
        seen.add(key);
        return true;
    }).slice(0, 12);
    
    list.innerHTML = stations.map((s, i) => `
        <div class="station-item" id="st-${i}" onclick='playStation(${JSON.stringify({
            name: s.name, url: s.url_resolved || s.url, favicon: s.favicon, tags: s.tags
        }).replace(/'/g, "\\'")}  , ${i})'>
            <div class="station-logo">
                ${s.favicon ? `<img src="${s.favicon}" onerror="this.parentElement.textContent='üìª'">` : 'üìª'}
            </div>
            <div>
                <div class="station-name">${s.name.substring(0, 30)}</div>
                <div class="station-tags">${(s.tags || '').split(',').slice(0,3).join(', ')}</div>
            </div>
        </div>
    `).join('');
}

function playStation(station, idx) {
    // Stop current
    audio.pause();
    audio.src = '';
    
    // Remove playing state from all
    document.querySelectorAll('.station-item').forEach(s => s.classList.remove('playing'));
    
    // Play new
    audio.src = station.url;
    audio.volume = document.getElementById('volume').value / 100;
    audio.play().catch(e => console.log('Play error:', e));
    
    currentStation = station;
    document.getElementById(`st-${idx}`).classList.add('playing');
    
    // Show now playing
    document.getElementById('npName').textContent = station.name;
    document.getElementById('npGenre').textContent = station.tags?.split(',').slice(0,3).join(', ') || '';
    document.getElementById('nowPlaying').classList.add('active');
}

function stopRadio() {
    audio.pause();
    audio.src = '';
    currentStation = null;
    document.querySelectorAll('.station-item').forEach(s => s.classList.remove('playing'));
    document.getElementById('nowPlaying').classList.remove('active');
}

function setVolume(val) {
    audio.volume = val / 100;
}

// Load energy stations by default
loadGenre('energy');
</script>
</body>
</html>
